#!/usr/bin/env python
#
# produce_db.py
#
# Outputs each acrylic vessel tile in ratdb format, using the SNOMAN geometry.dat data.
#
# Author P G Jones - 2013-10-01 <p.g.jones@qmul.ac.uk> : First revision
#        N Barros  - 2015-06-24 <nfbarros@hep.upenn.edu> : Added new DB fields
#                                                          Generated tables with line breaks
####################################################################################################
import math
import yaml
from collections import OrderedDict

def output_band(band):
    for iTile in range(0, len(band["name"])):
        db = OrderedDict([("type" , '"SOLID"'),
                          ("version",1),
                          ("index" , '"%s"' % band["name"][iTile]),
                          ("solid" , '"sphere"'),
                          ("run_range" , "[0, 0]"),
                          ("pass" , 0),
                          ("production" , "false"),
                          ("timestamp",'""'),
                          ("comment" , '""'),
                          ("r_max" , "7000.0"),#"6060.0",
                          ("r_min" , "5000.0"),#"6005.0",
                          ("phi_start" , math.degrees(band["phi_small"][iTile])),
                          ("phi_delta" , math.fabs(math.degrees(band["phi_large"][iTile]) - math.degrees(band["phi_small"][iTile]))),
                          ("theta_start" , 90.0 - math.degrees(math.atan(band["tan_up"]))),
                          ("theta_delta" , math.degrees(math.atan(band["tan_up"])) - math.degrees(math.atan(band["tan_low"])))])
        #print  yaml.dump(db).replace("]", "],")
        ## Do a manual print
        print "{"
        for key,value in db.iteritems():
            print key+": "+str(value)+","
        print "}"



band1 = {"tan_up" : 5.806904460, # tan(theta)
         "tan_low" : 1.383325654, # tan(theta)
         "name" : ["110-02", "110-11", "110-10", "110-07", "110-slice-1", "109-05", "119-11", "110-04", 
                   "110-01", "110-slice-2", "110-09", "110-05", "110-13", "110-12", "110-06"],
         "phi_large" : [3.392219067, -1.441000462, -0.957678556, -0.635463953, -0.313249350, 0.008965254, 
                        0.492287278, 0.975609183, 1.297823787, 1.620038390, 1.942253113, 2.425575018, 2.908896923, -2.407639503, -1.924317360],
         "phi_small" : [2.910298586, -1.922920942, -1.439599037, -0.956276894, -0.634062290, -0.311847687, 
                        0.010366917, 0.493688822, 0.977010787, 1.299225450, 1.621440053, 1.943654656, 2.426976681, -2.889559746, -2.406237841]}
band2 = {"tan_up" : 1.381851985, # tan(theta)
         "tan_low" : 0.811374676, # tan(theta)
         "name" : ["108-08", "108-02", "108-01", "108-07", "108-04", "108-03", "108-11a", "108-10b", "108-09", "108-06", "108-05"],
         "phi_large" : [3.601389170, -0.968200207, -0.397001624, 0.174197078, 0.745395720, 1.316594362, 1.887793064, 2.458991766, 3.030190468, -2.110592842, -1.539393902],
         "phi_small" : [3.030962944, -1.538626194, -0.967427492, -0.396228909, 0.174969792, 0.746168435, 1.317367077, 1.888565779, 2.459764481, -2.681018591, -2.109819889]}
band3 = {"tan_up" : 0.810477827, # tan(theta)
         "tan_low" : 0.435621983, # tan(theta)
         "name" : ["106-02", "106-06", "106-13", "106-07", "106-12", "106-11", "106-09", "106-08", "106-03", "106-04", "106-05", "106-10", "106-01"],
         "phi_large" : [3.261879921, -1.571339607, -1.088017702, -0.604695559, -0.121373773, 0.361948252, 0.845270157, 1.328592062, 1.811914086, 
                        2.295236111, 2.778557777, -2.537978411, -2.054656506],
         "phi_small" : [2.779174328, -2.054045200, -1.570723295, -1.087401390, -0.604079485, -0.120757461, 0.362564445, 0.845886409, 1.329208374, 
                        1.812530279, 2.295852184, -3.020684242, -2.537362099]}
band4 = {"tan_up" : 0.435019921, # tan(theta)
         "tan_low" : 0.139312978, # tan(theta)
         "name" : ["104-04", "104-08", "104-07", "104-12", "104-10", "104-11", "104-09", "104-01", "104-05", "104-02", "104-03", "104-06", "104-13a"],
         "phi_large" : [3.560682774, -1.272536516, -0.789214611, -0.305892706, 0.177429199, 0.660751164, 1.144073129, 1.627395034, 2.110717058, 
                        2.594038963, 3.077360868, -2.239175797, -1.755853653],
         "phi_small" : [3.077924728, -1.755294800, -1.271972656, -0.788650751, -0.305328846, 0.177993059, 0.661315024, 1.144636989, 1.627958894, 
                        2.111280918, 2.594602823, -2.721933365, -2.238611221]}
band5 = {"tan_up" : 0.138779256, # tan(theta)
         "tan_low" : -0.138779256, # tan(theta)
         "name" : ["101-10", "102-08", "101-08", "102-05", "101-09", "102-09", "101-05", "102-10", "101-02", "102-02", "101-04", "102-04", "101-06", 
                   "102-06", "101-07", "102-07", "102-03", "101-03", "102-01", "101-01"],
         "phi_large" : [3.344470978, -1.405765533, -1.053758860, -0.777446985, -0.425440311, -0.149128556, 0.202878237, 0.479189992, 0.831096709, 
                        1.107508540, 1.459515214, 1.735827088, 2.087833881, 2.364145517, 2.716152191, 2.992464066, -2.662397623, -2.310390949, 
                        -2.034079075, -1.682072639],
         "phi_small" : [2.992996454, -1.681545019, -1.405233383, -1.053226471, -0.776914835, -0.424908042, -0.148596168, 0.203410506, 0.479722381, 
                        0.831729054, 1.108040810, 1.460047603, 1.736359358, 2.088366032, 2.364677906, 2.716684818, -2.938177109, -2.661865234, 
                        -2.309858561, -2.033546448]}
band6 = {"tan_up" : -0.139312978, # tan(theta)
         "tan_low" : -0.435019921, # tan(theta)
         "name" : ["103-07", "103-10", "103-05", "103-02", "103-08", "103-04", "103-12", "103-06", "103-03", "103-09", "103-01", "103-11", "103-13a"],
         "phi_large" : [3.560682774, -1.272536516, -0.789214611, -0.305892706, 0.177429199, 0.660751164, 1.144073129, 1.627395034, 2.110717058, 
                        2.594038963, 3.077360868, -2.239175797, -1.755853653],
         "phi_small" : [3.077924728, -1.755294800, -1.271972656, -0.788650751, -0.305328846, 0.177993059, 0.661315024, 1.144636989, 1.627958894, 
                        2.111280918, 2.594602823, -2.721933365, -2.238611221]}
band7 = {"tan_up" : -0.139312978, # tan(theta)
         "tan_low" : -0.810477827, # tan(theta)
         "name" : ["105-03", "105-08", "105-01", "105-12", "105-07", "105-04", "105-09", "105-05", "105-02", "105-11", "105-13", "105-06", "105-10"],
         "phi_large" : [3.261879921, -1.571339607, -1.088017702, -0.604695559, -0.121373773, 0.361948252, 0.845270157, 1.328592062, 1.811914086, 
                        2.295236111, 2.778557777, -2.537978411, -2.054656506],
         "phi_small" : [2.779174328, -2.054045200, -1.570723295, -1.087401390, -0.604079485, -0.120757461, 0.362564445, 0.845886409, 1.329208374, 
                        1.812530279, 2.295852184, -3.020684242, -2.537362099]}
band8 = {"tan_up" : -0.811374676, # tan(theta)
         "tan_low" : -1.381851985, # tan(theta)
         "name" : ["107-07", "107-02", "107-03", "107-05", "107-01", "107-06", "107-04", "107-11", "107-08", "107-09", "107-10"],
         "phi_large" : [3.601389170, -0.968200207, -0.397001624, 0.174197078, 0.745395720, 1.316594362, 1.887793064, 2.458991766, 3.030190468, -2.110592842, -1.539393902],
         "phi_small" : [3.030962944, -1.538626194, -0.967427492, -0.396228909, 0.174969792, 0.746168435, 1.317367077, 1.888565779, 2.459764481, -2.681018591, -2.109819889]}
band9 = {"tan_up" : -1.383325654, # tan(theta)
         "tan_low" : -5.806904460, # tan(theta)
         "name" : ["109-07", "109-02", "109-08", "109-13", "109-09", "109-01", "109-03", "109-12", "109-05a", "109-06", "109-11a", 
                   "109-10", "109-04", "109-slice"],
         "phi_large" : [3.392219067, -1.441000462, -0.957678556, -0.474356651, 0.008965254, 0.492287278, 0.975609183, 1.458931088, 
                        1.942253113, 2.425575018, 2.908896923, -2.407639503, -2.085424423, -1.763210297],
         "phi_small" : [2.910298586, -1.761813641, -1.439599037, -0.956276894, -0.472954988, 0.010366917, 0.493688822, 0.977010787, 
                        1.460332751, 1.943654656, 2.426976681, -2.889559746, -2.406237841, -2.084023476]}
band10 = {"tan_up" : -5.825749072, # tan(theta)
         "tan_low" : -100.0, # tan(theta)
         "name" : ["111-02", "111-01"],
         "phi_large" : [-0.007009387, 3.140890598],
         "phi_small" : [-3.141592500, 0.007006884]}

output_band(band1)
output_band(band2)
output_band(band3)
output_band(band4)
output_band(band5)
output_band(band6)
output_band(band7)
output_band(band8)
output_band(band9)
output_band(band10)
